#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

echo "Running pre-commit checks..."

# Run black formatter (auto-fix)
if python - <<'PY'
import importlib.util
raise SystemExit(0 if importlib.util.find_spec("black") else 1)
PY
then
  echo "ðŸŽ¨ Running black formatter..."
  python -m black tradingagents/ cli/ scripts/ --quiet
else
  echo "âš ï¸  black not installed; skipping formatting."
fi

# Run ruff linter (auto-fix, but don't fail on warnings)
if python - <<'PY'
import importlib.util
raise SystemExit(0 if importlib.util.find_spec("ruff") else 1)
PY
then
  echo "ðŸ” Running ruff linter..."
  python -m ruff check tradingagents/ cli/ scripts/ --fix --exit-zero
else
  echo "âš ï¸  ruff not installed; skipping linting."
fi

# CRITICAL: Check for syntax errors (this will fail the commit)
echo "ðŸ Checking for syntax errors..."
python -m compileall -q tradingagents cli scripts

echo "âœ… Pre-commit checks passed!"
